<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulir Penyewaan</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Space Grotesk', 'Roboto', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #E8F1FF;
            color: #1A1A1A;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }

        .container {
            background-color: #FFFFFF;
            padding: 35px;
            border: 3px solid #1A1A1A;
            border-radius: 10px; /* Border radius lebih halus */
            box-shadow: 8px 8px 0 #1A1A1A;
            width: 90%;
            max-width: 700px;
            position: relative;
            top: 0;
            left: 0;
            transition: all 0.2s ease;
        }

        .container:hover {
            top: -2px;
            left: -2px;
            box-shadow: 10px 10px 0 #1A1A1A;
        }

        h2 {
            text-align: center;
            margin-bottom: 40px;
            color: #1A1A1A;
            font-weight: 700;
            font-size: 2.5em;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 3px solid #4A78F4;
            padding-bottom: 10px;
        }

        .form-section {
            margin-bottom: 35px;
            border: 2px solid #4A78F4;
            padding: 25px;
            border-radius: 10px; /* Border radius lebih halus */
            background-color: #F5F9FF;
            position: relative;
            transition: all 0.3s ease;
        }

        .form-section:hover {
            transform: translate(-2px, -2px);
            box-shadow: 4px 4px 0 #4A78F4;
        }

        .form-section h3 {
            margin: -25px -25px 20px -25px;
            padding: 15px 25px;
            background-color: #4A78F4;
            color: white;
            font-weight: 600;
            letter-spacing: 0.5px;
            border-top-left-radius: 8px;  /* Menyesuaikan dengan border radius form-section */
            border-top-right-radius: 8px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #1A1A1A;
            font-weight: 600;
            font-size: 1.1em;
        }

        .form-group input[type="text"],
        .form-group input[type="tel"],
        .form-group input[type="date"],
        .form-group input[type="number"],
        .form-group textarea,
        .form-group input[type="text"][readonly] {
            width: 100%;
            padding: 12px;
            border: 2px solid #1A1A1A;
            border-radius: 8px; /* Border radius lebih halus */
            box-sizing: border-box;
            font-size: 1em;
            background-color: white;
            transition: all 0.2s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #4A78F4;
            box-shadow: 4px 4px 0 #4A78F4;
            transform: translate(-2px, -2px);
        }

        .form-group button {
            background-color: #4A78F4;
            color: white;
            padding: 15px 25px;
            border: 2px solid #1A1A1A;
            border-radius: 8px; /* Border radius lebih halus */
            cursor: pointer;
            display: block;
            width: 100%;
            font-weight: 600;
            font-size: 1.1em;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.2s ease;
            position: relative;
            top: 0;
            left: 0;
        }

        .form-group button:hover {
            background-color: #3961E3;
            transform: translate(-4px, -4px);
            box-shadow: 4px 4px 0 #1A1A1A;
        }

        .form-group button:active {
            transform: translate(0, 0);
            box-shadow: none;
        }

        .form-group input[type="file"] {
            width: 100%;
            padding: 10px;
            border: 2px solid #1A1A1A;
            border-radius: 8px; /* Border radius lebih halus */
            margin-bottom: 10px;
            background-color: white;
        }

        .form-group .note {
            font-style: italic;
            color: #4A78F4;
            margin-top: 6px;
            font-size: 0.9em;
            font-weight: 500;
        }

        /* Animation classes */
        .form-section.hidden {
            opacity: 0;
            transform: translateY(20px);
        }
        .form-group.location-group {
            display: flex;
            flex-direction: column;
        }

        .form-group.location-group input {
            flex: 1;
            margin-bottom: 10px; /* Adjust the margin to give space */
            margin-right: 0; /* Make sure no horizontal margin */
        }
        .form-group.location-group button {
            width: auto; /* Adjust the width */
              padding: 10px 20px; /* Adjust padding */
            margin-bottom: 10px; /* Adjust margin */
            align-self: flex-start;
        }

        @media (max-width: 600px) {
            body{
                 padding: 10px; /* Mengurangi padding body agar lebih full pada mobile */
             }

            .container {
                width: 100%;
                 padding: 20px 0; /* Menghapus padding kanan kiri pada mobile */
                margin: 0;  /* Reset margin untuk full screen pada mobile */
            }
             .form-section{
                padding: 15px;
             }
              .form-section h3{
                margin: -15px -15px 15px -15px;
                padding: 12px 15px;
             }
            .form-group.location-group {
                flex-direction: column; /* Align vertically on smaller screens */
            }

            .form-group.location-group input,
            .form-group.location-group button {
                 width: 100%; /* Make the input and button fill the row */
                margin-right: 0; /* Reset margin on smaller screens */
                margin-bottom: 10px; /* Ensure space between them */
            }

        }
     #qrcode{
       text-align: center;
   }
    </style>
</head>
<body>
    <div class="container">
        <h2>Formulir Penyewaan</h2>
        <form id="sewaForm">
           <div id="step1" class="form-section">
                <h3>Data Penyewa</h3>
                <div class="form-group">
                    <label for="namaPenyewa">Nama Lengkap:</label>
                    <input type="text" id="namaPenyewa" name="namaPenyewa" required>
                </div>
                <div class="form-group">
                    <label for="asalKtp">Asal/E-KTP (Kab/Kota):</label>
                    <input type="text" id="asalKtp" name="asalKtp" required>
                </div>
                <div class="form-group">
                    <label for="nomorIdentitas">Nomor Identitas (E-KTP):</label>
                    <input type="text" id="nomorIdentitas" name="nomorIdentitas" required>
                </div>
                <div class="form-group">
                    <label for="teleponPenyewa">Nomor Telepon Aktif:</label>
                    <input type="tel" id="teleponPenyewa" name="teleponPenyewa" required>
                </div>
                <div class="form-group">
                    <label for="alamatDomisili">Alamat Domisili Saat Ini:</label>
                    <textarea id="alamatDomisili" name="alamatDomisili" rows="3" required></textarea>
                </div>
               <div class="form-group location-group">
                    <label for="lokasi">Lokasi:</label>
                     <input type="text" id="latitude" name="latitude" placeholder="Latitude" readonly required>
                      <input type="text" id="longitude" name="longitude" placeholder="Longitude" readonly required>
                    <button type="button" id="getLocation">Dapatkan Lokasi</button>
                </div>
                <div class="form-group">
                    <button type="button" id="nextStep1">Lanjut</button>
                </div>
            </div>
            <div id="step2" class="form-section">
                <h3>Data Penjamin/Keluarga</h3>
                <div class="form-group">
                    <label for="namaPenjamin">Nama Lengkap Penjamin/Keluarga:</label>
                    <input type="text" id="namaPenjamin" name="namaPenjamin" required>
                </div>
                <div class="form-group">
                    <label for="hubunganPenyewa">Hubungan dengan Penyewa:</label>
                    <input type="text" id="hubunganPenyewa" name="hubunganPenyewa" required>
                </div>
                 <div class="form-group">
                     <label for="teleponPenjamin">Nomor Telepon Penjamin:</label>
                     <input type="tel" id="teleponPenjamin" name="teleponPenjamin" required>
                 </div>
                <div class="form-group">
                    <label for="alamatPenjamin">Alamat Domisili Penjamin/Keluarga:</label>
                   <textarea id="alamatPenjamin" name="alamatPenjamin" rows="3" required></textarea>
                </div>
                 <div class="form-group">
                     <label for="tanggalSewa">Sewa untuk Hari & Tanggal:</label>
                     <input type="date" id="tanggalSewa" name="tanggalSewa" required>
                </div>
                  <div class="form-group">
                      <label for="durasiSewa">Berapa Hari:</label>
                      <input type="number" id="durasiSewa" name="durasiSewa" min="1" required>
                  </div>
                 <div class="form-group">
                      <label for="tujuanSewa">Tujuan Sewa:</label>
                      <textarea id="tujuanSewa" name="tujuanSewa" rows="3" required></textarea>
                  </div>
                     <div class="form-group">
                         <label for="totalBiaya">Total Biaya Sewa:</label>
                          <input type="text" id="totalBiaya" name="totalBiaya" readonly>
                     </div>
                <div class="form-group">
                    <button type="button" id="nextStep2">Lanjut</button>
                </div>
            </div>

             <div id="step3" class="form-section">
                 <h3>Lampiran Dokumen</h3>
                <div class="form-group">
                   <label>Foto Identitas Penyewa (2 Identitas):</label>
                   <input type="file" name="identitasPenyewa1" accept="image/*" required>
                     <input type="file" name="identitasPenyewa2" accept="image/*" required>
                     <p class="note">E-KTP/NPWP/SIM/BPJS (2 identitas dengan nama sama)</p>
                 </div>
                 <div class="form-group">
                     <label>Foto Rumah/Domisili (Tampak Depan):</label>
                     <input type="file" name="fotoRumah" accept="image/*" required>
                 </div>
                 <div class="form-group">
                    <label>Foto Identitas Penjamin:</label>
                    <input type="file" name="identitasPenjamin" accept="image/*" required>
                </div>
                 <div class="form-group">
                     <button type="button" id="prevStep3">Kembali</button>
                     <button type="button" id="showQris">Lanjut Pembayaran</button>
                  </div>
             </div>
                <div id="step4" class="form-section" style="display:none">
                    <h3>Pembayaran QRIS</h3>
                    <p>Silahkan Scan QR Code Dibawah Ini Untuk Melanjutkan Pembayaran</p>
                  <div id="qrcode"></div>
                    <button type="button" id="backToForm">Kembali ke Formulir</button>
                </div>
        </form>
       <input type="hidden" id="qrisInput" value="00020101021126710019ID.CO.CIMBNIAGA.WWW011893600022000040943502150000083009010470303UMI51450015ID.OR.QRNPG.WWW0215ID10221659161000303UMI5204599953033605802ID5914MITRABL*5007216006JEPARA61055941162120708M006057163042A1F">
    </div>
      <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
    <script>
    function pad(number) {
                return number < 10 ? '0' + number : number.toString();
         }

         function toCRC16(input) {
            let crc = 0xFFFF;
            for (let i = 0; i < input.length; i++) {
                crc ^= input.charCodeAt(i) << 8;
                for (let j = 0; j < 8; j++) {
                    crc = (crc & 0x8000) ? (crc << 1) ^ 0x1021 : crc << 1;
                }
            }
           let hex = (crc & 0xFFFF).toString(16).toUpperCase();
           return hex.length === 3 ? "0" + hex : hex;
        }

       function makeString(qris, { nominal } = {}) {
            let qrisModified = qris.slice(0, -4).replace("010211", "010212");
            let qrisParts = qrisModified.split("5802ID");

            let amount = "54" + pad(nominal.toString().length) + nominal;
            amount += "5802ID";

            let output = qrisParts[0].trim() + amount + qrisParts[1].trim();
           output += toCRC16(output);

            return output;
        }
        document.addEventListener('DOMContentLoaded', function () {
            const sewaForm = document.getElementById('sewaForm');
            const step1 = document.getElementById('step1');
            const step2 = document.getElementById('step2');
            const step3 = document.getElementById('step3');
            const step4 = document.getElementById('step4');
            const nextStep1 = document.getElementById('nextStep1');
            const nextStep2 = document.getElementById('nextStep2');
            const prevStep3 = document.getElementById('prevStep3');
             const showQris = document.getElementById('showQris');
              const backToForm = document.getElementById('backToForm');
              const durasiSewaInput = document.getElementById('durasiSewa');
            const totalBiayaInput = document.getElementById('totalBiaya');
              const getLocationButton = document.getElementById('getLocation');
            const latitudeInput = document.getElementById('latitude');
            const longitudeInput = document.getElementById('longitude');
            const hargaPerHari = 5000;
               let locationEnabled = false;


            getLocationButton.addEventListener('click', function() {
                 if(locationEnabled){
                     alert("Anda sudah mendapatkan lokasi sebelumnya");
                      return;
                    }
                   if(navigator.geolocation){
                       navigator.geolocation.getCurrentPosition(
                            function(position){
                                latitudeInput.value = position.coords.latitude;
                                longitudeInput.value = position.coords.longitude;
                                 locationEnabled = true;
                                alert('Lokasi berhasil didapatkan!');
                             },
                           function(error){
                               console.error('Error getting location:', error);
                               alert('Gagal mendapatkan lokasi. Pastikan izin lokasi diaktifkan.');
                           }
                       );
                   }else{
                       alert('Geolocation tidak didukung oleh browser Anda.');
                   }
               });


            // Fungsi untuk validasi dan transisi ke step berikutnya
            function validateAndTransition(currentStep, nextStep) {
                if (currentStep === step1) {
                    const namaPenyewa = document.getElementById('namaPenyewa').value.trim();
                    const asalKtp = document.getElementById('asalKtp').value.trim();
                    const nomorIdentitas = document.getElementById('nomorIdentitas').value.trim();
                    const teleponPenyewa = document.getElementById('teleponPenyewa').value.trim();
                    const alamatDomisili = document.getElementById('alamatDomisili').value.trim();
                       const latitude = latitudeInput.value.trim();
                    const longitude = longitudeInput.value.trim();

                    if (namaPenyewa === '' || asalKtp === '' || nomorIdentitas==='' || teleponPenyewa === '' || alamatDomisili ==='' || latitude ==='' || longitude === '') {
                        alert('Mohon lengkapi semua data pada bagian Data Penyewa!');
                        return;
                    }
                }else if(currentStep === step2){
                    const namaPenjamin = document.getElementById('namaPenjamin').value.trim();
                    const hubunganPenyewa = document.getElementById('hubunganPenyewa').value.trim();
                    const teleponPenjamin = document.getElementById('teleponPenjamin').value.trim();
                    const alamatPenjamin = document.getElementById('alamatPenjamin').value.trim();
                    const tanggalSewa = document.getElementById('tanggalSewa').value;
                    const durasiSewa = document.getElementById('durasiSewa').value;
                    const tujuanSewa = document.getElementById('tujuanSewa').value.trim();
                    if (namaPenjamin === '' || hubunganPenyewa===''|| teleponPenjamin === '' || alamatPenjamin==='' || tanggalSewa === '' || durasiSewa === '' || tujuanSewa === '') {
                       alert('Mohon lengkapi semua data pada bagian Data Penjamin dan Detail Penyewaan!');
                         return;
                    }
                // Hitung total biaya
                    const durasi = parseInt(durasiSewa, 10);
                       if(!isNaN(durasi)){
                           const totalBiaya = durasi * hargaPerHari;
                           totalBiayaInput.value = totalBiaya.toLocaleString('id-ID', { style: 'currency', currency: 'IDR' });
                         }else{
                           totalBiayaInput.value = ''; // Kosongkan jika input tidak valid
                        }
                }

                currentStep.classList.add('hidden'); // Efek smooth hide
                    setTimeout(function() {
                        currentStep.style.display = 'none';
                        nextStep.style.display = 'block';
                        nextStep.classList.remove('hidden'); // Efek smooth show
                    }, 300); //delay time animation
             }
        
            nextStep1.addEventListener('click', function () {
                validateAndTransition(step1, step2);
            });

            nextStep2.addEventListener('click', function () {
               validateAndTransition(step2, step3);
          });
         
          durasiSewaInput.addEventListener('input', function(){
              const durasi = parseInt(durasiSewaInput.value, 10);
                if(!isNaN(durasi)){
                   const totalBiaya = durasi * hargaPerHari;
                    totalBiayaInput.value = totalBiaya.toLocaleString('id-ID', { style: 'currency', currency: 'IDR' });
                  }else{
                     totalBiayaInput.value = ''; // Kosongkan jika input tidak valid
                  }
          });

           prevStep3.addEventListener('click', function () {
              step3.classList.add('hidden');
                setTimeout(function(){
                  step3.style.display = 'none';
                   step2.style.display = 'block';
                    step2.classList.remove('hidden');
              }, 300);
          });

        showQris.addEventListener('click', function(){
           const identitasPenyewa1 = document.querySelector('input[name="identitasPenyewa1"]').files[0];
           const identitasPenyewa2 = document.querySelector('input[name="identitasPenyewa2"]').files[0];
           const fotoRumah = document.querySelector('input[name="fotoRumah"]').files[0];
           const identitasPenjamin = document.querySelector('input[name="identitasPenjamin"]').files[0];
            if(!identitasPenyewa1 || !identitasPenyewa2 || !fotoRumah || !identitasPenjamin){
                alert('Mohon lampirkan semua file!');
                  return;
               }
          const nominal =  parseInt(totalBiayaInput.value.replace(/[^\d]/g, ''));
             step3.classList.add('hidden');
             setTimeout(function(){
                  step3.style.display = 'none';
                  step4.style.display = 'block';
                     step4.classList.remove('hidden');
                const qrisInput = document.getElementById('qrisInput').value.trim();
                const qrisDinamis = makeString(qrisInput, { nominal: nominal });
                  const qrcodeElement = document.getElementById('qrcode');
                    qrcodeElement.innerHTML = '';
                     QRCode.toCanvas(qrisDinamis, { 
                         margin: 2, 
                         width: 200,
                       scale: 8
                   }, function (err, canvas) {
                         if (err) {
                           console.error(err);
                           alert('Gagal membuat QR Code');
                           } else {
                               qrcodeElement.appendChild(canvas);
                         }
                  });
              }, 300);

        });
          backToForm.addEventListener('click', function(){
                step4.classList.add('hidden');
                   setTimeout(function(){
                       step4.style.display = 'none';
                       step1.style.display = 'block';
                        step1.classList.remove('hidden');
                   sewaForm.reset();
                    locationEnabled= false;
                    }, 300);

          })

            sewaForm.addEventListener('submit', function (event) {
                 event.preventDefault();
              alert('Formulir berhasil disubmit!');
               sewaForm.reset();
                step1.style.display = 'block';
                step2.style.display = 'none';
                step3.style.display = 'none';
                locationEnabled=false;
            });
            step2.style.display = 'none';
            step3.style.display = 'none';
            step4.style.display = 'none'
        });
    </script>
</body>
</html>